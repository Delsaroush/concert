{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
    <style>
        nav {
            background: #444;
            color: white;
            padding: 10px;
            text-align: center;
        }
        nav a {
            color: white;
            margin: 10px;
            text-decoration: none;
        }
        nav a:hover {
            text-decoration: underline;
        }
    </style>
    <link rel="stylesheet" type="text/css" href="{% static 'styles.css' %}">
    <title>Concert List</title>
</head>

<body>
    <h1>Upcoming Concerts</h1>

    <!-- Filter Form -->
    <form id="filter-form" method="get" action="{% url 'filter_concerts' %}">
        <label for="start_date">Start Date:</label>
        <input type="date" name="start_date" id="start_date">
        <label for="end_date">End Date:</label>
        <input type="date" name="end_date" id="end_date">
        <button type="button" id="filter-btn">Filter</button>
    </form>

    <!-- Concert Results -->
    <div id="concert-results">
        <ul>
            {% for concert in concerts %}
                <li>
                    <strong>{{ concert.name }}</strong><br>
                    Date: {{ concert.date }}<br>
                    Venue: {{ concert.venue }}<br>
                    <a href="{% url 'book_ticket' concert.id %}">Book Ticket</a>
                </li>
            {% empty %}
                <li>No concerts found!</li>
            {% endfor %}
        </ul>
    </div>

    <!-- Pagination -->
    <div class="pagination">
        <span class="step-links">
            Page {{ page_obj.number }} of {{ page_obj.paginator.num_pages }}
        </span>
    </div>

    <script>
        // Add Event Listener for AJAX Filtering
        document.getElementById('filter-btn').addEventListener('click', function() {
            const startDate = document.getElementById('start_date').value;
            const endDate = document.getElementById('end_date').value;

            // Fetch Filtered Results
            fetch(`/filter_concerts?start_date=${startDate}&end_date=${endDate}`)
                .then(response => {
                    if (!response.ok) {
                        throw new Error('Network response was not ok');
                    }
                    return response.text();
                })
                .then(data => {
                    document.getElementById('concert-results').innerHTML = data; // Update content
                })
                .catch(error => {
                    console.error('Error:', error);
                    document.getElementById('concert-results').innerHTML =
                        '<p style="color:red;">An error occurred while fetching concerts.</p>';
                });
        });
    </script>
</body>
</html>
